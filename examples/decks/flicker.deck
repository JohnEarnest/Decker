{deck}
version:1
card:0
size:[512,342]
name:"Flicker: FlickGame converter for Decker"
author:"Internet Janitor"

{card:flickertool}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AOYBDAD/APIBEAD/APABEgAEAQYALAEFAP8AswETAAMBCAAqAQcA/wCxARQAAgEKACgBCQD/AK8BFAACAQsAKAEJAP8ArgEUAAMBCwAoAQoA/wCsAQsADQELACgBCwD/AKsBCAARAQoAKQEKACIJCgAMCQYA/wBtAQcAEwEJACoBCQAgCQ4ACQkIAAYJCwD/AFoBCAAVAQcALAEHABABAwAMCRAABwkKAAMJDwD/AFgBCAAUAQgABwEDACIBBwAPAQUACgkSAAYJHQD/AFcBBwAVAQgABgEFAA8BCgAIAQcADgEHAAgJFAAFCR4A/wBWAQcAFQEHAAYBBwANAQwABwEHAA0BCAAICRUABQkdAP8AVgEHABQBCAAGAQcACwEPAAYBBwALAQoABwkWAAYJHQD/AFUBBwAUAQgABQEIAAoBEAAGAQcACQEMAAcJCAAFCQoABgkcAP8AVQEHABMBCAAFAQkACQERAAYBBwAIAQwABwkIAAgJCAAGCQ4ABgkIAP8AVQEHABMBCAAFAQgACQERAAcBBwAHAQwACAkIAAkJCAAFCQwACQkHAP8AVQEHAAgBAwAIAQcABgEHAAkBEQAIAQcABQENAAgJCQAFCQwABQkJAAwJBwD/AE0BGwAGAQgABwEFAAoBCgAPARgACQkbAAQJBwAOCQcA/wBMAR0ABQEIAAgBAwAKAQkAEQEXAAoJGwAECQcADwkFAP8ATAEeAAUBBwAVAQkAEgEUAA0JGwAECQgADwkDAP8ATQEeAAQBCAAVAQgAEwEUAA0JGwAECQgA/wBfAR0ABQEIABUBCAATARQADQkaAAYJBwD/AGABGwAFAQgACQEDAAoBBwAUARUADAkZAAcJCAD/AGABGQAGAQgACAEFAAkBBwAUARUADAkQABAJCAD/AGgBBwAQAQcACAEHAAgBBwAUAQcABwEIAAsJBwAaCQcA/wBoAQcADwEIAAgBBwAIAQcAFAEHAAcBCQAKCQcAGgkHAP8AaAEHAA8BCAAIAQcACAEHABQBBwAIAQkACQkIABkJBwD/AGgBBwAPAQcACQEHAAgBBwAUAQcACQEJAAgJCAAZCQcA/wBoAQcADwEHAAkBBwAIAQgAEwEHAAoBCAAICQkAGAkHAP8AaAEHAA8BBwAJAQcACAEJABIBBwAKAQkACAkMAAkJBAAHCQcA/wBoAQcADwEHAAkBBwAJAQgAEgEHAAsBCQAICQwABgkHAAYJBwD/AGcBCAAOAQgACQEHAAkBCQAFAQUABgEIAAsBCQAICRoABQkHAP8AZgEJAA4BCAAJAQcACgETAAUBCAAMAQgACQkZAAUJBwD/AGYBCAAPAQcACgEHAAsBEwAEAQgADQEIAAkJGAAFCQcA/wBhAQ0ADwEKAAcBCQAKARIAAwEIAA4BCAALCRUABwkFAP8AYQENABABCwAGAQoACgERAAMBCAAPAQcADAkTAAkJAwD/AGEBDQASAQsABQELAAoBDwAEAQgAEAEFABEJDQD/AG8BDQASAQsABgEKAAsBDQAGAQYAEgEDABMJCwD/AHABDAAUAQoABwEJAAwBCQAKAQQA/wClAQoAFgEIAAkBBwD/AMoBBwAZAQYACwEFAP8AzAEFAP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/ANANzQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA0BAMsNAQD/ADQNAQDLDQEA/wA0DQEAyw0BAP8ANA3NAP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A4A=="
script:"flickertool.0"
{widgets}
field1:{"type":"field","size":[193,15],"pos":[148,76],"locked":1,"border":0,"align":"center","value":{"text":["convert ","flickgame"," exports into decks!"],"font":["","",""],"arg":["","https://www.flickgame.org",""]}}
palettes:{"type":"grid","size":[100,50],"pos":[8,322],"show":"none","value":{"key":["antiquity16","arq16","bubblegum-16","colodore","color-graphics-adapter","commodore64","cretaceous-16","darkseed-16","dawnbringer-16","daylight-16","endesga-16","eroge-copper","fading-16","galaxy-flame","go-line","grayscale-16","island-joy-16","lost-century","microsoft-windows","miyazaki-16","na16","nanner-jam","pico-8","r-place","shido-cyberneon","steam-lords","summers-past-16","sweetie-16","taffy-16","urbex-16","vanilla-milkshake","woodspark"],"value":[[2105376,2957598,4532515,7159081,11627338,15245166,15253122,6124887,9343575,7371656,9086892,15031629,15828588,13788976,14588456,15259813],[16777215,16765341,11449789,5079241,15284289,1050656,3873834,7023682,11285042,14243683,14130045,16243623,15066597,11718102,8754593,4876097],[1447706,8324642,14033937,16745510,16765184,16449023,16744612,16721524,9707882,4391015,2312565,6860500,12582716,1102453,30873,10329],[0,16777215,8467256,7720648,9321623,5680205,3026075,15593841,9326633,5584896,12872817,4868682,8092539,11141023,7368171,11711154],[0,170,43520,43690,11141120,11141290,11162880,11184810,5592405,5592575,5635925,5636095,16733525,16733695,16777045,16777215],[0,16777215,8912896,11206638,13386956,52309,170,15658615,14518357,6702080,16742263,3355443,7829367,11206502,35071,12303291],[1975080,4799531,10570358,15310667,15567451,15907210,16246706,13094860,10987948,6646905,2960194,1711148,6104925,11615827,15695191,16764277],[2237219,15791856,9757508,6527999,9137991,12891645,14708619,16754856,16053492,12635100,9147757,4868682,1973790,3947580,9127187,13468991],[1313820,4465716,3159149,5130830,8735792,3433764,13649480,7696737,5864910,13794604,8754593,7186988,13806233,7193290,14341214,14610134],[1711148,6104925,11615827,15695191,16764277,11006064,3716964,2453881,2700911,3890633,4302582,7598071,16053492,9744578,5663878,3357783],[12470831,14120515,15389866,14984818,12087120,7552569,4073265,10626611,14957380,16217634,16690740,16705377,6539085,4098376,2513986,1653822],[854029,4859205,9128519,12746054,14858567,16118721,14344426,11056580,7173517,4803932,3025454,6830188,11882632,15771296,16044700,14344426],[1051405,1710618,3026478,4868682,7039851,9276813,11382189,12895428,14277081,15461355,16250871,16777215,15263976,13684944,12105912,10395294],[723723,1710618,3026478,4868682,7039851,9276813,11382189,12895428,14277081,15461355,16250871,16777215,15263976,13684944,12105912,10395294],[723723,1710618,3026478,4868682,7039851,9276813,11382189,12895428,14277081,15461355,16250871,16777215,15263976,13684944,12105912,10395294],[0,1118481,2236962,3355443,4473924,5592405,6710886,7829367,8947848,10066329,11184810,12303291,13421772,14540253,15658734,16777215],[1317183,2499402,4865111,6830188,11882632,15771296,16044700,14344426,11056580,7173517,4803932,3025454,6830188,11882632,15771296,16044700],[2891313,6966419,10904524,14723839,13073919,10309341,7473591,5639085,4721832,3804323,4143049,4415982,4756975,5032432,7473591,5639085],[0,8388608,32768,8421376,128,8388736,32896,12632256,8421504,16711680,65280,16776960,255,16711935,65535,16777215],[1711148,6104925,11615827,15695191,16764277,11006064,3716964,2453881,2700911,3890633,4302582,7598071,16053492,9744578,5663878,3357783],[1313820,4465716,3159149,5130830,8735792,3433764,13649480,7696737,5864910,13794604,8754593,7186988,13806233,7193290,14341214,14610134],[1313820,4465716,3159149,5130830,8735792,3433764,13649480,7696737,5864910,13794604,8754593,7186988,13806233,7193290,14341214,14610134],[0,1911635,8267091,34641,11227702,6248271,12764103,16773608,16711757,16753408,16772135,58422,2731519,8615580,16742312,16764074],[0,9014672,13948889,16777215,7143450,12451897,16729344,16754688,16766517,41832,52344,8318294,30063,40618,2379940,3576042],[986915,2829138,5987213,9145287,11250677,13092863,14935039,16119295,16747403,16755595,16763787,16771979,13369227,9174923,9174955,9174987],[1313820,4465716,3159149,5130830,8735792,3433764,13649480,7696737,5864910,13794604,8754593,7186988,13806233,7193290,14341214,14610134],[1313820,4465716,3159149,5130830,8735792,3433764,13649480,7696737,5864910,13794604,8754593,7186988,13806233,7193290,14341214,14610134],[1711148,6104925,11615827,15695191,16764277,11006064,3716964,2453881,2700911,3890633,4302582,7598071,16053492,9744578,5663878,3357783],[1313820,4465716,3159149,5130830,8735792,3433764,13649480,7696737,5864910,13794604,8754593,7186988,13806233,7193290,14341214,14610134],[1313820,4465716,3159149,5130830,8735792,3433764,13649480,7696737,5864910,13794604,8754593,7186988,13806233,7193290,14341214,14610134],[1313820,4465716,3159149,5130830,8735792,3433764,13649480,7696737,5864910,13794604,8754593,7186988,13806233,7193290,14341214,14610134],[1313820,4465716,3159149,5130830,8735792,3433764,13649480,7696737,5864910,13794604,8754593,7186988,13806233,7193290,14341214,14610134]]}}
skipblank:{"type":"button","size":[155,14],"pos":[41,130],"font":"body","text":"Don't convert blank pages","style":"check","value":1}
createlocked:{"type":"button","size":[155,14],"pos":[41,148],"font":"body","text":"Create a locked deck","style":"check","value":0}
button1:{"type":"button","size":[182,33],"pos":[44,275],"script":"flickertool.1","text":"Convert"}
namepattern:{"type":"field","size":[100,20],"pos":[121,176],"font":"mono","value":"flick_%i"}
field2:{"type":"field","size":[73,25],"pos":[41,174],"locked":1,"border":0,"value":"naming pattern for cards:"}
field3:{"type":"field","size":[73,18],"pos":[41,209],"locked":1,"border":0,"value":"image scale:"}
scale:{"type":"slider","size":[100,20],"pos":[121,207],"interval":[1,3],"value":3,"style":"compact"}
field4:{"type":"field","size":[52,16],"pos":[40,106],"locked":1,"font":"menu","border":0,"align":"center","value":"options"}
refcanvas:{"type":"canvas","size":[160,100],"pos":[360,311],"script":"flickertool.2","show":"none","scale":1}
field5:{"type":"field","size":[226,202],"pos":[260,106],"locked":1,"border":0,"value":{"text":["This tool reads .html exports of games made with FlickGame and constructs a deck based on its contents. You can then edit the games freely in ","Decker.","\n\nEvery page in the original game becomes a card background image. Information about which color links to which page is stored as a dictionary in an invisible field named \"links\" on each card. A transparent canvas on each card will intercept click[] events, decode them based on the color of pixels in the background image and the contents of \"links\", and send a flick[] event.\n\nBy modifying the flick[] event handler (and possibly importing additional modules) you can configure transition animations and delays, play sound effects, or trigger more complex scripts as desired."],"font":["","",""],"arg":["","http://beyondloom.com/decker/",""]}}
deckref:{"type":"button","size":[60,20],"pos":[133,322],"script":"flickertool.3","show":"none"}

{script:flickertool.0}
on process f do
 local u:first "<!--__EmbedEnd__-->" split last "var embeddedDat=\"" split f
 local d:"%j" parse
   "]"  fuse "%5D" split
   "["  fuse "%5B" split
   "{r}"  fuse "%7D" split
   "{l}"  fuse "%7B" split
   "\"" fuse "%22" split u

 local pals:raze palettes.value
 local pal:pals["dawnbringer-16"] unless pals[d.palette_name]
 local links:each x in d.hyperlinks
  raze each v i in x if 0~v ()dict() else i dict 0+v end end
 end
 local pages:each c in d.canvasses
  r:image[refcanvas.size]
  r.pixels:each p in 2 window c
   (first p) take "%h" parse last p
  end
  r
 end
 alert["Decoded FlickGame export."]
 
 local ndeck:newdeck[]
 each col i in pal
  ndeck.patterns[32+i]:col
 end
 each page i in pages
  if ! skipblank.value & (list 0)~keys page.hist
   card:ndeck.add["card" namepattern.text format 1+i]
   link:card.add["field" "links"]
   link.data:each v k in links[i] namepattern.text format v end
   link.show:"none"
   canv:card.add["canvas" "flick_canvas"]
   canv.size:refcanvas.size*scale.value
   canv.pos:p:.5*card.size-canv.size
   canv.show:"transparent"
   canv.script:refcanvas.script
   canv.border:0
   canv.locked:1
   card.image.paste[page.map[32+range 16].scale[scale.value] p]
  end
 end
 ndeck.remove[ndeck.cards.home]
 ndeck.corners:0
 ndeck.script:deckref.script
 ndeck.locked:createlocked.value
 alert["Prepared Deck.\nSave it as an .html or .deck file."]
 
 write[ndeck]
end
{end}

{script:flickertool.1}
on click do
 local f:read[]
 if count f process[f] end
end
{end}

{script:flickertool.2}
on click pos do
 links:me.parent.widgets.links.data
 pixel:me.parent.image[pos+me.pos]-32
 flick[links[pixel]]
end

{end}

{script:flickertool.3}
on navigate dir do
 if !deck.locked
  send navigate[dir]
 end
end

on flick dest do
 go[dest]
end
{end}

